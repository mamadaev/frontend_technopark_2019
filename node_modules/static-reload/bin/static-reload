#!/usr/bin/env node

const http = require('http')
const path = require('path')
const reloader = require('../')

const { argv, cwd } = process
const { log } = console

if (argv[2] === 'start') {
  const entry = argv[3] || cwd()
  const port = argv[4] || 3000
  const server = http.createServer()
  const enabled = []

  reloader.start(server, {
    entry,
    onreload () {
      log(`Reloaded http://localhost:${port}`)
    },
    oninject (f) {
      if (enabled.indexOf(f) < 0) {
        log(`Enabled reload on ${path.relative(entry, f)}`)
        enabled.push(f)
      }
    }
  })

  server.listen(port, 'localhost', () => {
    log(`Started server at http://localhost:${port}`)
  })
} else {
  reloader.reload({
    address: 'localhost',
    port: argv[3] || 3000
  })
}
